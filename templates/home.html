{% from 'bootstrap5/form.html' import render_form %}

{% include "header.html" %}
<div>
    <h1>Billify</h1>
    <div>
        <form id="date-form">
            {{ render_form(form, novalidate=True, button_map={"submit": "primary"}) }}
        </form>
    </div>
    <div id="link-container"></div>
</div>

    <script>
        $(document).ready(function () {
            $('#date-form').on('submit', function (e) {
                e.preventDefault(); // Prevent the default form submission

                // Add loading state to the submit button
                const submitButton = $(this).find('button[type="submit"]');
                submitButton.addClass('loading').text('Loading...');

                // Serialize form data and make AJAX request
                const formData = $(this).serialize();
                $.ajax({
                    url: '/',
                    type: 'POST',
                    data: formData,
                    success: function (response) {
                        // Update the link container with the response
                        $('#link-container').html(response.link ?
                            `<a href="${response.link}">Click Here</a>` : '');

                        // Reset the button to its original state
                        submitButton.removeClass('loading').text('Submit');
                    },
                    error: function () {
                        alert('An error occurred. Please try again.');
                        submitButton.removeClass('loading').text('Submit');
                    }
                });
            });
        });
    </script>
</body>
</html>
